---
title: "View cell images"
author: "Shantanu SIngh"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{View cell images}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r setup, echo=FALSE}
library(knitr)
options(EBImage.display = "raster")
```


```{r warning=FALSE, message=FALSE}
library(cytovizr)
library(dplyr)
library(magrittr)

```


The minimal set of columns are:

```{r}
ljosa2013 %>%
  slice(1:5) %>%
  select(Metadata_Plate, Metadata_Well, Metadata_Site, Metadata_pert_id, 
         matches("URL"))
  knitr::kable()

```

Compute robust maximum intensity per channel to normalize the intensities
(otherwise the images appear too dim).

```{r warning=FALSE, message=FALSE}
# B02 is DMSO
max_intensity <- 
ljosa2013 %>%
  filter(Metadata_Plate %in% c("Week1_22123", 
                               "Week1_22141", 
                               "Week1_22161") & 
           Metadata_Well == "B02") %>%
  group_by(Metadata_Plate) %>%
  arrange(Metadata_Well, Metadata_Site) %>%
  slice(1:4) %>%
  ungroup() %>% 
  sample_max_intensity()
```


Save the images

```{r warning=FALSE, message=FALSE}
images <-
ljosa2013 %>%
  filter(Metadata_Plate == "Week1_22123" & Metadata_Well == "B04") %>%
  save_images(per_row = 2, max_intensity = max_intensity)
```

Select one image and view it

```{r}
actin <- images$Week1_22123_B04$Actin %>%
  EBImage::readImage() 
```

```{r display, fig.width=8}
EBImage::display(actin)
```
